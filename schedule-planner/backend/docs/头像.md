<!-- Author: å”éœ‡ -->

## å¤´åƒç›¸å…³çš„ API æ–‡æ¡£

### **ä¸Šä¼ å¤´åƒæ¥å£**

**æ¥å£åç§°ï¼š**`/api/user/avatar/upload`

**åŠŸèƒ½**ï¼šä¸Šä¼ å¤´åƒï¼Œä¿å­˜å¤´åƒæ–‡ä»¶å¹¶è¿”å›å¤´åƒçš„ URL åœ°å€ã€‚

**è¯·æ±‚å‚æ•°**ï¼š

| å­—æ®µ   | è¯´æ˜           | ç±»å‹   | å¤‡æ³¨                         | æ˜¯å¦å¿…å¡« |
| ------ | -------------- | ------ | ---------------------------- | -------- |
| avatar | å¤´åƒæ–‡ä»¶       | file   | ä¸Šä¼ çš„å¤´åƒå›¾ç‰‡æ–‡ä»¶           | æ˜¯       |
| token  | ç”¨æˆ·èº«ä»½ token | string | å½“å‰ç™»å½•ç”¨æˆ·çš„èº«ä»½éªŒè¯ token | æ˜¯       |

**è¿”å›å‚æ•°**ï¼š

| å­—æ®µ      | è¯´æ˜          | ç±»å‹   | å¤‡æ³¨                          | æ˜¯å¦å¿…å¡« |
| --------- | ------------- | ------ | ----------------------------- | -------- |
| code      | æ¥å£çŠ¶æ€ç     | number | æˆåŠŸï¼š1ï¼Œå¤±è´¥ï¼š0              | æ˜¯       |
| message   | æ¥å£è¿”å›ä¿¡æ¯  | string | æˆåŠŸï¼šsuccessï¼Œå¤±è´¥ï¼šé”™è¯¯ä¿¡æ¯ | æ˜¯       |
| avatarUrl | å¤´åƒ URL åœ°å€ | string | å¤´åƒä¸Šä¼ åçš„è®¿é—® URL åœ°å€     | æ˜¯       |

**ç¤ºä¾‹è¯·æ±‚**ï¼š

```http
POST /api/user/avatar/upload
```

è¯·æ±‚ä½“ï¼š

```json
{
  "avatar": "file_data", // ä¸Šä¼ çš„å¤´åƒæ–‡ä»¶
  "token": "mock-token-abc123"
}
```

**å“åº”**ï¼š

```json
{
  "code": 1,
  "message": "å¤´åƒä¸Šä¼ æˆåŠŸ",
  "avatarUrl": "/assets/demo_icon.jpg"  // è¿”å›å¤´åƒçš„ URL åœ°å€
}
```

------



### **ä½¿ç”¨ QQ å¤´åƒæ¥å£**

**æ¥å£åç§°ï¼š**`/api/user/avatar/qq`

**åŠŸèƒ½**ï¼šä½¿ç”¨ QQ å¤´åƒï¼Œä¼ å…¥ QQ å¤´åƒé“¾æ¥ï¼Œæ›´æ–°ç”¨æˆ·å¤´åƒã€‚

**è¯·æ±‚å‚æ•°**ï¼š

| å­—æ®µ   | è¯´æ˜           | ç±»å‹   | å¤‡æ³¨                         | æ˜¯å¦å¿…å¡« |
| ------ | -------------- | ------ | ---------------------------- | -------- |
| avatar | QQ å¤´åƒé“¾æ¥    | string | é€šè¿‡ QQ è·å–çš„å¤´åƒé“¾æ¥       | æ˜¯       |
| token  | ç”¨æˆ·èº«ä»½ token | string | å½“å‰ç™»å½•ç”¨æˆ·çš„èº«ä»½éªŒè¯ token | æ˜¯       |

**è¿”å›å‚æ•°**ï¼š

| å­—æ®µ      | è¯´æ˜          | ç±»å‹   | å¤‡æ³¨                          | æ˜¯å¦å¿…å¡« |
| --------- | ------------- | ------ | ----------------------------- | -------- |
| code      | æ¥å£çŠ¶æ€ç     | number | æˆåŠŸï¼š1ï¼Œå¤±è´¥ï¼š0              | æ˜¯       |
| message   | æ¥å£è¿”å›ä¿¡æ¯  | string | æˆåŠŸï¼šsuccessï¼Œå¤±è´¥ï¼šé”™è¯¯ä¿¡æ¯ | æ˜¯       |
| avatarUrl | å¤´åƒ URL åœ°å€ | string | å¤´åƒæ›´æ–°åçš„è®¿é—® URL åœ°å€     | æ˜¯       |

**ç¤ºä¾‹è¯·æ±‚**ï¼š

```http
POST /api/user/avatar/qq
```

è¯·æ±‚ä½“ï¼š

```json
{
  "avatar": "http://q.qlogo.cn/headimg_dl?dst_uin=12345678&spec=640&img_type=jpg",
  "token": "mock-token-abc123"
}
```

**å“åº”**ï¼š

```json
{
  "code": 1,
  "message": "QQå¤´åƒå·²æ›´æ–°",
  "avatarUrl": "http://q.qlogo.cn/headimg_dl?dst_uin=12345678&spec=640&img_type=jpg"
}
```

æˆ‘å°†æä¾›å®Œæ•´çš„å¤´åƒåŠŸèƒ½æ¥å£æµ‹è¯•æµç¨‹ï¼Œä»æ³¨å†Œç™»å½•å¼€å§‹åˆ°æµ‹è¯•ä¸¤ä¸ªå¤´åƒæ¥å£ã€‚

## ğŸ§ª Postman å¤´åƒåŠŸèƒ½æµ‹è¯•æµç¨‹

### ç¬¬ä¸€æ­¥ï¼šç”¨æˆ·æ³¨å†Œ

**POST** `http://127.0.0.1:5000/api/register`

**Headers:**
```
Content-Type: application/json
```

**Body (raw JSON):**
```json
{
  "nickname": "å¤´åƒæµ‹è¯•ç”¨æˆ·",
  "email": "avatar_test@example.com",
  "password": "123456",
  "phone": "13812345678"
}
```

**é¢„æœŸå“åº”:**
```json
{
  "code": 1,
  "message": "success",
  "data": {
    "token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...",
    "nickname": "å¤´åƒæµ‹è¯•ç”¨æˆ·",
    "avatar": "https://imgheybox.max-c.com/bbs/2024/09/19/1dc7d8a7978e8e9be26498747ef493ce/thumb.png",
    "email": "avatar_test@example.com",
    "phone": "13812345678",
    "role": "user"
  }
}
```

---

### ç¬¬äºŒæ­¥ï¼šç”¨æˆ·ç™»å½•ï¼ˆè·å–æœ€æ–°tokenï¼‰

**POST** `http://127.0.0.1:5000/api/login`

**Headers:**
```
Content-Type: application/json
```

**Body (raw JSON):**
```json
{
  "email": "avatar_test@example.com",
  "password": "123456"
}
```

**é¢„æœŸå“åº”:**
```json
{
  "code": 1,
  "message": "success",
  "data": {
    "token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...",
    "nickname": "å¤´åƒæµ‹è¯•ç”¨æˆ·",
    "avatar": "https://imgheybox.max-c.com/bbs/2024/09/19/1dc7d8a7978e8e9be26498747ef493ce/thumb.png",
    "email": "avatar_test@example.com",
    "phone": "13812345678",
    "role": "user"
  }
}
```

**âš ï¸ é‡è¦ï¼šå¤åˆ¶å“åº”ä¸­çš„ `token` å€¼ï¼Œåç»­æµ‹è¯•éœ€è¦ä½¿ç”¨**

---

### ç¬¬ä¸‰æ­¥ï¼šæµ‹è¯•ä¸Šä¼ å¤´åƒæ¥å£

**POST** `http://127.0.0.1:5000/api/user/avatar/upload`

**Headers:**
```
æ³¨æ„ï¼šä¸è¦è®¾ç½® Content-Typeï¼Œè®© Postman è‡ªåŠ¨å¤„ç† multipart/form-data
```

**Body é€‰æ‹© form-data:**
```
Key: token
Value: eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...ï¼ˆä½ çš„å®é™…tokenï¼‰

Key: avatar
Type: Fileï¼ˆç‚¹å‡» Key å³ä¾§çš„ä¸‹æ‹‰èœå•é€‰æ‹© Fileï¼‰
Value: [ç‚¹å‡» "Select Files" é€‰æ‹©ä¸€ä¸ªå›¾ç‰‡æ–‡ä»¶]
```

**æ”¯æŒçš„å›¾ç‰‡æ ¼å¼ï¼š** PNGã€JPGã€JPEGã€GIFã€WEBP
**æ–‡ä»¶å¤§å°é™åˆ¶ï¼š** æœ€å¤§ 5MB

**é¢„æœŸå“åº”:**
```json
{
  "code": 1,
  "message": "å¤´åƒä¸Šä¼ æˆåŠŸ",
  "avatarUrl": "/uploads/avatars/avatar_1_abc12345.jpg"
}
```

**å¦‚æœä¸Šä¼ å¤±è´¥ï¼Œå¯èƒ½çš„é”™è¯¯å“åº”:**
```json
{
  "code": 0,
  "message": "åªæ”¯æŒ PNGã€JPGã€JPEGã€GIFã€WEBP æ ¼å¼çš„å›¾ç‰‡"
}
```

æˆ–

```json
{
  "code": 0,
  "message": "æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡5MB"
}
```

---

### ç¬¬å››æ­¥ï¼šéªŒè¯ä¸Šä¼ çš„å¤´åƒæ˜¯å¦å¯è®¿é—®

**GET** `http://127.0.0.1:5000/uploads/avatars/avatar_1_abc12345.jpg`

**è¯´æ˜ï¼š** ä½¿ç”¨ç¬¬ä¸‰æ­¥å“åº”ä¸­è¿”å›çš„ `avatarUrl` è·¯å¾„

**é¢„æœŸç»“æœï¼š** åº”è¯¥èƒ½å¤Ÿç›´æ¥åœ¨æµè§ˆå™¨ä¸­çœ‹åˆ°ä¸Šä¼ çš„å›¾ç‰‡

---

### ç¬¬äº”æ­¥ï¼šæµ‹è¯•ä½¿ç”¨QQå¤´åƒæ¥å£

**POST** `http://127.0.0.1:5000/api/user/avatar/qq`

**Headers:**
```
Content-Type: application/json
```

**Body (raw JSON):**
```json
{
  "token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...",
  "avatar": "http://q.qlogo.cn/headimg_dl?dst_uin=123456789&spec=640&img_type=jpg"
}
```

**å…¶ä»–å¯ç”¨çš„æµ‹è¯•QQå¤´åƒé“¾æ¥ï¼š**
```json
{
  "token": "ä½ çš„token",
  "avatar": "https://q1.qlogo.cn/g?b=qq&nk=123456789&s=640"
}
```

**é¢„æœŸå“åº”:**
```json
{
  "code": 1,
  "message": "QQå¤´åƒå·²æ›´æ–°", 
  "avatarUrl": "http://q.qlogo.cn/headimg_dl?dst_uin=123456789&spec=640&img_type=jpg"
}
```

---

### ç¬¬å…­æ­¥ï¼šè·å–ç”¨æˆ·ä¿¡æ¯éªŒè¯å¤´åƒæ›´æ–°

**POST** `http://127.0.0.1:5000/api/user/profile`

**Headers:**
```
Content-Type: application/json
```

**Body (raw JSON):**
```json
{
  "token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9..."
}
```

**é¢„æœŸå“åº”:**
```json
{
  "code": 1,
  "message": "è·å–ç”¨æˆ·ä¿¡æ¯æˆåŠŸ",
  "data": {
    "id": 1,
    "nickname": "å¤´åƒæµ‹è¯•ç”¨æˆ·",
    "phone": "13812345678",
    "email": "avatar_test@example.com",
    "avatar": "http://q.qlogo.cn/headimg_dl?dst_uin=123456789&spec=640&img_type=jpg",
    "role": "user",
    "created_at": "2024-12-19 10:30:00",
    "updated_at": "2024-12-19 10:35:00"
  }
}
```

---

## ğŸ” è¾¹ç•Œæµ‹è¯•ç”¨ä¾‹

### æµ‹è¯•1ï¼šä¸Šä¼ æ— æ•ˆæ–‡ä»¶æ ¼å¼

**POST** `http://127.0.0.1:5000/api/user/avatar/upload`

**Body (form-data):**
```
token: ä½ çš„token
avatar: [é€‰æ‹©ä¸€ä¸ª .txt æˆ–å…¶ä»–éå›¾ç‰‡æ–‡ä»¶]
```

**é¢„æœŸå“åº”:**
```json
{
  "code": 0,
  "message": "åªæ”¯æŒ PNGã€JPGã€JPEGã€GIFã€WEBP æ ¼å¼çš„å›¾ç‰‡"
}
```

### æµ‹è¯•2ï¼šæ— æ•ˆçš„QQå¤´åƒé“¾æ¥

**POST** `http://127.0.0.1:5000/api/user/avatar/qq`

```json
{
  "token": "ä½ çš„token",
  "avatar": "invalid-url"
}
```

**é¢„æœŸå“åº”:**
```json
{
  "code": 0,
  "message": "å¤´åƒé“¾æ¥æ ¼å¼ä¸æ­£ç¡®"
}
```

### æµ‹è¯•3ï¼šæ— æ•ˆtoken

**POST** `http://127.0.0.1:5000/api/user/avatar/upload`

**Body (form-data):**
```
token: invalid-token
avatar: [é€‰æ‹©å›¾ç‰‡æ–‡ä»¶]
```

**é¢„æœŸå“åº”:**
```json
{
  "code": 0,
  "message": "ç”¨æˆ·æœªç™»å½•æˆ– token æ— æ•ˆ"
}
```

### æµ‹è¯•4ï¼šç¼ºå°‘token

**POST** `http://127.0.0.1:5000/api/user/avatar/upload`

**Body (form-data):**
```
avatar: [é€‰æ‹©å›¾ç‰‡æ–‡ä»¶]
```

**é¢„æœŸå“åº”:**
```json
{
  "code": 0,
  "message": "tokenä¸èƒ½ä¸ºç©º"
}
```

### æµ‹è¯•5ï¼šæ²¡æœ‰é€‰æ‹©æ–‡ä»¶

**POST** `http://127.0.0.1:5000/api/user/avatar/upload`

**Body (form-data):**
```
token: ä½ çš„token
```

**é¢„æœŸå“åº”:**
```json
{
  "code": 0,
  "message": "æ²¡æœ‰é€‰æ‹©æ–‡ä»¶"
}
```
